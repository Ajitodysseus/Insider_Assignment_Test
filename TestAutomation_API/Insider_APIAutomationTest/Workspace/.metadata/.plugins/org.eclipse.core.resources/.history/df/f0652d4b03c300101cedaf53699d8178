package PO.InsiderDATA;

import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;
import static org.hamcrest.Matchers.*;

public class PetStoreCRUD_Test {

    int petId = 5001;   // static test pet id

    @BeforeClass
    public void setup() {
        RestAssured.baseURI = "https://petstore.swagger.io/v2";
    }

    // ============================
    // POST → Create a new pet
    // ============================
    @Test(priority = 1)
    public void createPet() {

        String payload = "{\n" +
                "  \"id\": " + petId + ",\n" +
                "  \"name\": \"Tommy\",\n" +
                "  \"status\": \"available\"\n" +
                "}";

        given()
                .contentType(ContentType.JSON)
                .body(payload)
        .when()
                .post("/pet")
        .then()
                .statusCode(200)
                .body("name", equalTo("Tommy"))
                .body("status", equalTo("available"));
    }

    // ===================================
    // GET → Read/Fetch the created pet
    // ===================================
    @Test(priority = 2)
    public void getPet() {

        given()
                .contentType(ContentType.JSON)
                .pathParam("petId", petId)
        .when()
                .get("/pet/{petId}")
        .then()
                .statusCode(200)
                .body("id", equalTo(petId))
                .body("name", equalTo("Tommy"));
    }

    // =============================
    // PUT → Update the pet details
    // =============================
    @Test(priority = 3)
    public void updatePet() {

        String updatedPayload = "{\n" +
                "  \"id\": " + petId + ",\n" +
                "  \"name\": \"Tommy Updated\",\n" +
                "  \"status\": \"sold\"\n" +
                "}";

        given()
                .contentType(ContentType.JSON)
                .body(updatedPayload)
        .when()
                .put("/pet")
        .then()
                .statusCode(200)
                .body("name", equalTo("Tommy Updated"))
                .body("status", equalTo("sold"));
    }

    // =============================
    // DELETE → Remove the pet
    // =============================
    @Test(priority = 4)
    public void deletePet() {

        given()
                .pathParam("petId", petId)
        .when()
                .delete("/pet/{petId}")
        .then()
                .statusCode(200)
                .body("message", equalTo(String.valueOf(petId)));
    }

    // ====================================================
    // NEGATIVE TEST → Get Deleted/Invalid Pet (404)
    // ====================================================
    @Test(priority = 5)
    public void getPetNegative() {

        given()
                .pathParam("petId", petId)
        .when()
                .get("/pet/{petId}")
        .then()
                .statusCode(404)
                .body("message", containsString("Pet not found"));
    }

    // ====================================================
    // NEGATIVE TEST → Create Pet with Invalid JSON
    // ====================================================
    @Test(priority = 6)
    public void createPetInvalidJson() {

        String invalidPayload = "{ \"id\": , \"name\": \"Invalid\" }"; // incorrect JSON

        given()
                .contentType(ContentType.JSON)
                .body(invalidPayload)
        .when()
                .post("/pet")
        .then()
                .statusCode(400); // Bad Request
    }
}
